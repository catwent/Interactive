<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="../../assets/main.css" type="text/css"/>
	<script src="../../assets/jquery-3.4.1.min.js"></script>
	<title>ASCIIng the Time on Mars</title>
	<style>
		#mars {
			margin-top: 100px;
			margin-left: 100px;
			margin-right: 100px;
			font-family: monospace;
			line-height: 6px;
			font-size: 9px;
			letter-spacing: 3px;
			display: inline-block;
		}
	</style>
</head>
<body>

	<div class="nav">
			<div class="site-title"><a href="../../index.html">Aerosolâ€”Weather</a></div>
			<div class="back-button"><a href="../../project-1/list_5_5.html">Back</a></div>
			<div class="next-button"><a href="../../index.html">Next</a></div>
	</div>

	<div id="mars"></div>

<!-- 	<script type="text/javascript" src="p5.min.js">
	</script>

	<script type="text/javascript" src="p5.dom.min.js">
	</script>s

	<script type="text/javascript" src="p5.asciiart.min.js">
	</script>

	<script type="text/javascript" src="ascii-test.js">
	</script> -->


	<script type="text/javascript">
		class imgToAscii {
		constructor(image,size,charType){
			this.size = ( size <= 0 || size > 1 ? 1 : size) || 1;
			this.charType = charType || 0;
			this.alphabet = {
				0: ["@","%","#","*","+","=","-",":","."," "],
				1: ["$","@","B","%","8","&","W","M","#","*","o","a","h","k","b","d","p","q","w","m","Z","O",
						"0","Q","L","C","J","U","Y","X","z","c","v","u","n","x","r","j","f","t","/","\\","|","(",
						")","1","{","}","[","]","?","-","_","+","~","\<","\>","i","!","l","I",";",":",",","\"","^",
						"`","'","."," "]
			}
			this.string = "";
			this.stringColor = "";
			this.imageSrc = image;
			this.loadImage = new Promise( (resolve,reject) =>{
				this.image = new Image();
				this.image.src = this.imageSrc;
				this.image.onload = ()=> {
					this.canvas = document.createElement('canvas');
					this.canvas.width = this.image.width * this.size;
					this.canvas.height = this.image.height * this.size;
					this.context = this.canvas.getContext('2d');
					this.context.drawImage(this.image, 0, 0, this.canvas.width, this.canvas.height);
					this.imageData = this.context.getImageData(0,0,this.canvas.width,this.canvas.height);
					let grayStep = Math.ceil( 255 / this.alphabet[this.charType].length );
					for(let i = 0; i < this.imageData.data.length; i+=4){
						for(let j = 0; j < this.alphabet[this.charType].length; j++){
							let r = this.imageData.data[i];
							let g = this.imageData.data[i+1];
							let b = this.imageData.data[i+2];
							if( (r * 0.2126) + (g * 0.7152) + (b * 0.0722) < (j+1) * grayStep ){
								this.string += this.alphabet[this.charType][j];
								this.stringColor += "<span style=\"color: rgb("+r+","+g+","+b+"); \">" 
																 +this.alphabet[this.charType][j]
																 +"</span>";
								break;	
							}
						}
						if( !((i/4+1) % this.canvas.width) ){
							this.string += "\n";
							this.stringColor += "<br>";
						}
					}
					resolve();
				};
				this.image.error = reject;
			}).catch( e => console.error(e) );
		}
		
		async display(){
			let pre = document.createElement('pre');
			pre.style.fontFamily = "Courier, monospace";
			pre.style.lineHeight = "6px";
			pre.style.fontSize = "11px";
			pre.style.display = "inline-block";
			document.body.appendChild(pre);
			await this.loadImage;
			pre.innerText = this.string;
			console.log(this.string)
			pre.style.display = "none";
		}

	}
	</script>


	<script type="text/javascript">
		let mars = new imgToAscii('mars8_200x150.png',0.8);
		mars.display();
		mars.crossOrigin = "anonymous";

		$( document ).ready(function() {
			var text = document.getElementsByTagName('pre')[0].innerText;
			var lines = text.split(/\r?\n/);
			console.log(lines, lines.length);
		    var delay=10;
			var elem = $("#mars");
			//elem - jQuery element where text is to be attached
			//delay - the delay in each text
			var addTextByDelay = function(inputText,elem,delay){
			   if(!elem){
			       elem = $("body");
			   }
			   if(!delay){
			       delay = 10;
			   }
			   if(inputText.length >0){
			       //append first character
			       elem.append(inputText[0]);
			       setTimeout(
			           function(){
			               //Slice text by 1 character and call function again                
			               addTextByDelay(inputText.slice(1),elem,delay);            
			            },delay                
			           );
			   }
			}
			for(var i = 0; i < lines.length; i++) {
				addTextByDelay(lines[i],elem,delay);
				elem.append('<br>');			
			}
			text.style.fontFamily = "Courier, monospace";
			text.style.lineHeight = "6px";
			text.style.fontSize = "9px";
			text.style.letterSpacing = "3px";
			text.style.display = "inline-block";
			});

	</script>


	<script type="text/javascript">
		var colors = ['darkgrey','#443e3e','darksalmon','darkgoldenrod','#dff0f4','cadetblue','linen'];
		var new_color = colors[Math.floor(Math.random()*colors.length)];
		$('body').css('background-color',new_color);
	</script>


</body>
</html>
